@{
    Layout = null;
    ViewData["Title"] = "Solicitudes de Becas";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Sistema de Becas CUC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .table-responsive {
            max-height: 600px;
            overflow-y: auto;
        }

        .badge-pendiente {
            background-color: #ffc107;
            color: #000;
        }

        .badge-completa {
            background-color: #198754;
        }

        .badge-incompleta {
            background-color: #dc3545;
        }

        .badge-evaluacion {
            background-color: #0dcaf0;
            color: #000;
        }

        .filter-card {
            margin-bottom: 20px;
        }

        .action-buttons .btn {
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

            .stat-card:hover {
                transform: translateY(-5px);
            }

            .stat-card .number {
                font-size: 2.5rem;
                font-weight: bold;
                color: #0d6efd;
                margin: 10px 0 0;
            }

        .action-button {
            background: #0d6efd;
            color: white;
            padding: 30px 20px;
            border-radius: 8px;
            text-align: center;
            text-decoration: none;
            font-size: 1.2rem;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

            .action-button:hover {
                background: #0b5ed7;
                transform: translateY(-3px);
                color: white;
            }

            .action-button i {
                font-size: 2rem;
                margin-bottom: 10px;
            }

        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-thin {
            height: 5px;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-award"></i> Becas CUC - Empleados
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" asp-action="EmpleadosDashboard">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" asp-action="EmpleadosConvocatorias">
                            <i class="bi bi-megaphone"></i> Convocatorias
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" asp-action="EmpleadosSolicitudes">
                            <i class="bi bi-file-earmark-text"></i> Solicitudes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" asp-action="EmpleadosEvaluaciones">
                            <i class="bi bi-clipboard-check"></i> Evaluaciones
                        </a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </nav>
    <div class="container mt-4">
      

        <div class="card filter-card">
            <div class="card-body">
                <form method="get" action="~/Home/EmpleadosSolicitudes">
                    <div class="row g-3">
                        <!-- Estado -->
                        <div class="col-md-4">
                            <label class="form-label">Estado</label>
                            <select class="form-select" name="estado">
                                <option value="0" selected="@(ViewBag.EstadoSeleccionado == 0)">Todos</option>
                                <option value="1" selected="@(ViewBag.EstadoSeleccionado == 1)">Pendiente</option>
                                <option value="5" selected="@(ViewBag.EstadoSeleccionado == 5)">Aprobada</option>
                                <option value="6" selected="@(ViewBag.EstadoSeleccionado == 6)">Rechazada</option>
                            </select>
                        </div>

                        <!-- Búsqueda -->
                        <div class="col-md-6">
                            <label class="form-label">Buscar</label>
                            <input type="text" class="form-control" placeholder="Nombre o cédula" name="busqueda" value="@ViewBag.Busqueda">
                        </div>

                        <div class="col-md-2 d-flex align-items-end">
                            <button class="btn btn-primary w-100" type="submit">Filtrar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de solicitudes -->
        <div class="card mt-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Listado de Solicitudes</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Estudiante</th>
                                <th>Cédula</th>
                                <th>Carrera</th>
                                <th>Tipo Beca</th>
                                <th>Fecha Solicitud</th>
                                <th>Estado</th>
                                <th>Resultado</th>
                                <th>Categoria</th>
                                <th>Fecha Resolución</th>
                                <th>Observaciones</th>
                                <th>Aprueba</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var solicitud in Model)
                            {
                                <tr>
                                    <td>@solicitud.IdSolicitud</td>
                                    <td>@solicitud.NombreEstudiante</td>
                                    <td>@solicitud.CedulaEstudiante</td>
                                    <td>@solicitud.Carrera</td>
                                    <td>@solicitud.TipoBeca</td>
                                    <td>@solicitud.FechaSolicitud.ToString("dd/MM/yyyy")</td>
                                    <td>
                                        @{
                                            var estadoBadge = solicitud.Estado switch
                                            {
                                                1 => ("En revisión", "badge-pendiente"),
                                                2 => ("Doc. completa", "badge-completa"),
                                                3 => ("Falta doc.", "badge-incompleta"),
                                                4 => ("En evaluación", "badge-evaluacion"),
                                                5 => ("Aprobada", "bg-success"),
                                                6 => ("Rechazada", "bg-danger"),
                                                _ => ("Desconocido", "bg-secondary")
                                            };
                                        }
                                        <span class="badge @estadoBadge.Item2">@estadoBadge.Item1</span>
                                    </td>
                                    <td>
                                        @if (solicitud.Resultado != null)
                                        {
                                            @(solicitud.Resultado == 1 ? "Aprobado" : "Rechazado")
                                        }
                                        else
                                        {
                                            @("-")
                                        }
                                    </td>
                                    <td>@(solicitud.CategoriaBecaSocioeconomicaAsignada ?? "-")</td>
                                    <td>@(solicitud.FechaResolucion?.ToString("dd/MM/yyyy") ?? "-")</td>
                                    <td>@(solicitud.Observaciones ?? "-")</td>
                                    <td>@(solicitud.PersonaAprueba ?? "-")</td>
                                    <td>
                                        <a asp-action="EmpleadosDetalleSolicitud" asp-route-id="@solicitud.IdSolicitud" class="btn btn-sm btn-outline-primary">
                                            Ver
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>